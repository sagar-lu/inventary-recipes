<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocina Mexicana & Inventario Inteligente</title>
    
    <!-- Tailwind CSS para el dise√±o moderno y limpio -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Poppins (T√≠tulos) e Inter (Cuerpo) como en el dise√±o original -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- SweetAlert2 para alertas bonitas -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Configuraci√≥n base */
        :root {
            --color-primary: #D2691E; /* Terra Cotta original */
            --color-secondary: #4F7942; /* Verde Cilantro */
            --color-bg: #F9FAFB;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg);
            padding-bottom: 80px; /* Espacio para navbar m√≥vil */
        }
        
        h1, h2, h3, h4, h5 {
            font-family: 'Poppins', sans-serif;
        }

        /* Ocultar scrollbar pero permitir scroll */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animaciones suaves */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilo de la navegaci√≥n inferior */
        .bottom-nav-item.active {
            color: var(--color-primary);
        }
        .bottom-nav-item.active i {
            transform: translateY(-2px);
        }

        /* Checkbox personalizado para inventario */
        .inventory-check:checked + div {
            background-color: #ECFDF5;
            border-color: var(--color-secondary);
            color: var(--color-secondary);
        }
        
        .inventory-check:checked + div .check-icon {
            opacity: 1;
            transform: scale(1);
        }

        /* Estilos espec√≠ficos de la captura de pantalla */
        .rounded-super {
            border-radius: 24px;
        }
        
        .category-circle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            transition: transform 0.2s;
        }
        .category-circle:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- ================= HEADER (M√≥vil Style) ================= -->
    <header class="bg-white sticky top-0 z-50 px-4 py-3 shadow-sm">
        <div class="flex items-center justify-between mb-2">
            <div>
                <p class="text-xs text-gray-500 font-medium">Buenos d√≠as,</p>
                <h1 class="text-xl font-bold text-gray-900">Mi Cocina Mexicana</h1>
            </div>
            <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600">
                <i class="fas fa-user"></i>
            </div>
        </div>
        
        <!-- Barra de b√∫squeda global -->
        <div class="relative">
            <input type="text" id="global-search" placeholder="Buscar recetas o ingredientes..." 
                   class="w-full bg-gray-100 text-gray-700 rounded-xl py-3 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-orange-300 transition-all">
            <i class="fas fa-search absolute left-4 top-3.5 text-gray-400"></i>
        </div>
    </header>

    <!-- ================= MAIN CONTENT AREA ================= -->
    <main id="app-content" class="p-4 max-w-3xl mx-auto fade-in">
        <!-- El contenido cambiar√° din√°micamente con JS -->
    </main>

    <!-- ================= BOTTOM NAVIGATION ================= -->
    <nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 px-6 py-3 flex justify-between items-center z-50 md:justify-center md:gap-12">
        <button onclick="router('home')" class="bottom-nav-item active flex flex-col items-center text-gray-400 hover:text-orange-600 transition-colors" id="nav-home">
            <i class="fas fa-home text-xl mb-1"></i>
            <span class="text-[10px] font-medium">Inicio</span>
        </button>
        
        <button onclick="router('inventory')" class="bottom-nav-item flex flex-col items-center text-gray-400 hover:text-orange-600 transition-colors" id="nav-inventory">
            <i class="fas fa-carrot text-xl mb-1"></i>
            <span class="text-[10px] font-medium">Inventario</span>
        </button>
        
        <!-- Bot√≥n Central de Acci√≥n -->
        <button onclick="generarRecetas()" class="bg-orange-600 text-white w-12 h-12 rounded-full flex items-center justify-center -mt-6 shadow-lg hover:bg-orange-700 transition-transform hover:scale-105 active:scale-95">
            <i class="fas fa-utensils"></i>
        </button>
        
        <button onclick="router('recipes')" class="bottom-nav-item flex flex-col items-center text-gray-400 hover:text-orange-600 transition-colors" id="nav-recipes">
            <i class="fas fa-book-open text-xl mb-1"></i>
            <span class="text-[10px] font-medium">Recetas</span>
        </button>
        
        <button onclick="router('favorites')" class="bottom-nav-item flex flex-col items-center text-gray-400 hover:text-orange-600 transition-colors" id="nav-favorites">
            <i class="fas fa-heart text-xl mb-1"></i>
            <span class="text-[10px] font-medium">Favoritos</span>
        </button>
    </nav>

    <!-- ================= SCRIPTS ================= -->
    <script>
        // ================= DATOS (Originales + Estructura Inventario) =================
        
        // Categor√≠as para el Inventario (Basado en la imagen)
        const categoriasInventario = [
            { id: 'frutas', nombre: 'Fruta', icono: 'apple-alt', color: 'bg-red-100 text-red-500', img: 'https://images.unsplash.com/photo-1619566636858-adf3ef46400b?auto=format&fit=crop&w=100&q=80' },
            { id: 'verduras', nombre: 'Verdura', icono: 'carrot', color: 'bg-green-100 text-green-500', img: 'https://images.unsplash.com/photo-1597362925123-77861d3fbac7?auto=format&fit=crop&w=100&q=80' },
            { id: 'proteinas', nombre: 'Prote√≠na', icono: 'drumstick-bite', color: 'bg-orange-100 text-orange-500', img: 'https://images.unsplash.com/photo-1607623814075-e51df1bdc82f?auto=format&fit=crop&w=100&q=80' },
            { id: 'despensa', nombre: 'Despensa', icono: 'box-open', color: 'bg-yellow-100 text-yellow-600', img: 'https://images.unsplash.com/photo-1590779033100-9f60a05a013d?auto=format&fit=crop&w=100&q=80' },
            { id: 'lacteos', nombre: 'L√°cteos', icono: 'cheese', color: 'bg-blue-100 text-blue-500', img: 'https://images.unsplash.com/photo-1628088062854-d1870b4553da?auto=format&fit=crop&w=100&q=80' }
        ];

        // Ingredientes comunes para selecci√≥n r√°pida
        const ingredientesComunesDB = [
            { id: 'pollo', nombre: 'Pollo', cat: 'proteinas' },
            { id: 'res', nombre: 'Carne de Res', cat: 'proteinas' },
            { id: 'cerdo', nombre: 'Carne de Cerdo', cat: 'proteinas' },
            { id: 'huevo', nombre: 'Huevos', cat: 'proteinas' },
            { id: 'tomate', nombre: 'Tomate', cat: 'verduras' },
            { id: 'cebolla', nombre: 'Cebolla', cat: 'verduras' },
            { id: 'ajo', nombre: 'Ajo', cat: 'verduras' },
            { id: 'chile', nombre: 'Chiles', cat: 'verduras' },
            { id: 'cilantro', nombre: 'Cilantro', cat: 'verduras' },
            { id: 'aguacate', nombre: 'Aguacate', cat: 'frutas' },
            { id: 'limon', nombre: 'Lim√≥n', cat: 'frutas' },
            { id: 'tortillas', nombre: 'Tortillas', cat: 'despensa' },
            { id: 'frijoles', nombre: 'Frijoles', cat: 'despensa' },
            { id: 'arroz', nombre: 'Arroz', cat: 'despensa' },
            { id: 'queso', nombre: 'Queso', cat: 'lacteos' },
            { id: 'crema', nombre: 'Crema', cat: 'lacteos' }
        ];

        // Datos de Recetas (Del archivo original, simplificado para JS)
        const recetasMexicanas = [
            {
                id: 1,
                nombre: "Tacos de Carnitas",
                descripcion: "Tacos tradicionales con carne de cerdo deshebrada.",
                imagen: "https://images.unsplash.com/photo-1565299585323-38d6b0865b47?auto=format&fit=crop&w=800&q=80",
                tiempo: 25,
                dificultad: "F√°cil",
                categoria: "Plato Principal",
                ingredientesBase: ["tortillas", "cerdo", "cebolla", "cilantro", "limon"],
                instrucciones: ["Calienta las tortillas.", "Deshebra la carne.", "Pica verdura.", "Arma el taco."]
            },
            {
                id: 2,
                nombre: "Enchiladas Rojas",
                descripcion: "Tortillas ba√±adas en salsa de chile guajillo y queso.",
                imagen: "https://images.unsplash.com/photo-1564758564527-b97d79cb27c1?auto=format&fit=crop&w=800&q=80",
                tiempo: 30,
                dificultad: "Media",
                categoria: "Plato Principal",
                ingredientesBase: ["tortillas", "pollo", "chile", "tomate", "queso", "crema", "cebolla"],
                instrucciones: ["Prepara la salsa.", "Rellena tortillas con pollo.", "Ba√±a en salsa.", "Decora."]
            },
            {
                id: 3,
                nombre: "Chilaquiles Verdes",
                descripcion: "Totopos ba√±ados en salsa verde con pollo.",
                imagen: "https://images.unsplash.com/photo-1624374053855-9700a1e2b4a2?auto=format&fit=crop&w=800&q=80",
                tiempo: 20,
                dificultad: "F√°cil",
                categoria: "Desayuno",
                ingredientesBase: ["tortillas", "tomate", "chile", "cilantro", "cebolla", "pollo", "queso", "crema"],
                instrucciones: ["Fr√≠e tortillas.", "Haz salsa verde.", "Mezcla.", "Sirve con queso."]
            },
            {
                id: 4,
                nombre: "Sopa de Tortilla",
                descripcion: "Caldo de tomate con tiras de tortilla frita.",
                imagen: "https://images.unsplash.com/photo-1584761635052-c4a408482464?auto=format&fit=crop&w=800&q=80",
                tiempo: 25,
                dificultad: "F√°cil",
                categoria: "Sopa",
                ingredientesBase: ["tortillas", "tomate", "cebolla", "ajo", "aguacate", "queso", "crema"],
                instrucciones: ["Haz caldillo de tomate.", "Fr√≠e tiras.", "Sirve caldo sobre tiras.", "Decora."]
            },
            {
                id: 5,
                nombre: "Arroz a la Mexicana",
                descripcion: "Arroz rojo cl√°sico esponjoso.",
                imagen: "https://images.unsplash.com/photo-1626804475297-411dbe277396?auto=format&fit=crop&w=800&q=80",
                tiempo: 25,
                dificultad: "F√°cil",
                categoria: "Guarnici√≥n",
                ingredientesBase: ["arroz", "tomate", "cebolla", "ajo", "zanahoria"],
                instrucciones: ["Dora el arroz.", "Lic√∫a tomate y ajo.", "Agrega caldo.", "Cocina tapado."]
            },
            {
                id: 6,
                nombre: "Pico de Gallo",
                descripcion: "Salsa fresca picada para acompa√±ar.",
                imagen: "https://images.unsplash.com/photo-1586618190336-0e3946d05563?auto=format&fit=crop&w=800&q=80",
                tiempo: 10,
                dificultad: "Muy F√°cil",
                categoria: "Salsa",
                ingredientesBase: ["tomate", "cebolla", "cilantro", "chile", "limon"],
                instrucciones: ["Pica todo finamente.", "Mezcla.", "Sazona con lim√≥n y sal."]
            },
             {
                id: 7,
                nombre: "Quesadillas Sencillas",
                descripcion: "Tortilla doblada con queso derretido.",
                imagen: "https://images.unsplash.com/photo-1618040996337-56904b7850b9?auto=format&fit=crop&w=800&q=80",
                tiempo: 10,
                dificultad: "Muy F√°cil",
                categoria: "Antojito",
                ingredientesBase: ["tortillas", "queso"],
                instrucciones: ["Calienta tortilla.", "Pon queso.", "Dobla hasta derretir."]
            }
        ];

        // Estado de la aplicaci√≥n
        let miInventario = new Set(); // Usamos Set para evitar duplicados
        let misFavoritos = new Set();

        // ================= LOGICA DE NAVEGACION =================
        
        function router(view) {
            // Actualizar estilo botones nav
            document.querySelectorAll('.bottom-nav-item').forEach(el => el.classList.remove('active', 'text-orange-600'));
            document.querySelectorAll('.bottom-nav-item').forEach(el => el.classList.add('text-gray-400'));
            
            const activeBtn = document.getElementById(`nav-${view}`);
            if(activeBtn) {
                activeBtn.classList.add('active', 'text-orange-600');
                activeBtn.classList.remove('text-gray-400');
            }

            const appContent = document.getElementById('app-content');
            appContent.innerHTML = ''; // Limpiar vista

            switch(view) {
                case 'home': renderHome(appContent); break;
                case 'inventory': renderInventory(appContent); break;
                case 'recipes': renderRecipes(appContent); break;
                case 'favorites': renderFavorites(appContent); break;
                default: renderHome(appContent);
            }
            
            // Scroll to top suave
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ================= VISTAS (VIEWS) =================

        // 1. HOME VIEW
        function renderHome(container) {
            container.innerHTML = `
                <!-- Banner Inventario (Estilo Captura) -->
                <div class="bg-gray-100 rounded-super p-6 mb-8 relative overflow-hidden cursor-pointer shadow-sm group" onclick="router('inventory')">
                    <div class="relative z-10 w-2/3">
                        <h2 class="text-2xl font-bold text-gray-800 leading-tight mb-2">Inventario de<br>Ingredientes</h2>
                        <p class="text-gray-500 text-sm mb-4">Gestiona lo que tienes en casa</p>
                        
                        <!-- Indicadores peque√±os -->
                        <div class="flex gap-2">
                            <div class="h-1 w-4 bg-orange-500 rounded-full"></div>
                            <div class="h-1 w-1 bg-gray-300 rounded-full"></div>
                            <div class="h-1 w-1 bg-gray-300 rounded-full"></div>
                            <div class="h-1 w-1 bg-gray-300 rounded-full"></div>
                        </div>
                    </div>
                    <div class="absolute right-0 top-0 h-full w-1/2">
                        <img src="https://images.unsplash.com/photo-1610832958506-aa56368176cf?auto=format&fit=crop&w=400&q=80" 
                             class="w-full h-full object-cover object-center mask-gradient group-hover:scale-105 transition-transform duration-500" alt="Frutas">
                    </div>
                </div>

                <!-- Accesos Directos (Estilo Captura "Agregar Productos") -->
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg">Explorar Categor√≠as</h3>
                    <i class="fas fa-chevron-right text-gray-400 text-sm"></i>
                </div>
                
                <div class="flex justify-between gap-2 overflow-x-auto hide-scrollbar pb-4 mb-4">
                    ${categoriasInventario.map(cat => `
                        <div class="flex flex-col items-center min-w-[70px]" onclick="router('inventory')">
                            <div class="category-circle bg-white shadow-sm border border-gray-100 overflow-hidden">
                                <img src="${cat.img}" class="w-full h-full object-cover opacity-90" alt="${cat.nombre}">
                            </div>
                            <span class="text-xs font-medium text-gray-600">${cat.nombre}</span>
                        </div>
                    `).join('')}
                </div>

                <!-- Reportes R√°pidos / Recetas Destacadas -->
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg">Recetas Populares</h3>
                    <i class="fas fa-chevron-right text-gray-400 text-sm"></i>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    ${recetasMexicanas.slice(0, 4).map(receta => `
                        <div class="bg-white rounded-2xl p-3 shadow-sm border border-gray-50 cursor-pointer hover:shadow-md transition-all" onclick="mostrarDetalleReceta(${receta.id})">
                            <div class="h-32 rounded-xl bg-gray-200 mb-3 overflow-hidden relative">
                                <img src="${receta.imagen}" class="w-full h-full object-cover" alt="${receta.nombre}">
                                <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-lg text-[10px] font-bold text-orange-600">
                                    ${receta.tiempo} min
                                </div>
                            </div>
                            <h4 class="font-bold text-sm text-gray-800 leading-tight mb-1">${receta.nombre}</h4>
                            <p class="text-xs text-gray-400">${receta.categoria}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 2. INVENTORY VIEW
        function renderInventory(container) {
            const totalItems = miInventario.size;
            
            container.innerHTML = `
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Mi Inventario</h2>
                        <p class="text-sm text-gray-500">Selecciona lo que tienes en casa</p>
                    </div>
                    <div class="bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-bold">
                        ${totalItems} items
                    </div>
                </div>

                <!-- Barra de b√∫squeda de ingredientes -->
                <div class="mb-6">
                    <input type="text" placeholder="Agregar ingrediente r√°pido..." 
                           class="w-full bg-white border border-gray-200 rounded-xl py-3 px-4 text-sm focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none">
                </div>

                <!-- Grid de Categor√≠as e Ingredientes -->
                <div class="space-y-6 pb-20">
                    ${categoriasInventario.map(cat => {
                        // Filtrar ingredientes de esta categor√≠a
                        const ings = ingredientesComunesDB.filter(i => i.cat === cat.id);
                        return `
                        <div>
                            <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full ${cat.color.split(' ')[0].replace('text', 'bg')}"></span>
                                ${cat.nombre}
                            </h3>
                            <div class="grid grid-cols-3 gap-3">
                                ${ings.map(ing => {
                                    const isSelected = miInventario.has(ing.id);
                                    return `
                                    <label class="cursor-pointer group relative">
                                        <input type="checkbox" class="inventory-check sr-only" 
                                               onchange="toggleInventario('${ing.id}')" ${isSelected ? 'checked' : ''}>
                                        <div class="bg-white border border-gray-100 rounded-xl p-3 flex flex-col items-center justify-center h-28 shadow-sm transition-all hover:shadow-md">
                                            <!-- Icono Check -->
                                            <div class="check-icon absolute top-2 right-2 bg-green-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs opacity-0 transform scale-0 transition-all duration-200">
                                                <i class="fas fa-check"></i>
                                            </div>
                                            
                                            <!-- Imagen/Icono del ingrediente (Placeholder visual) -->
                                            <div class="w-10 h-10 mb-2 rounded-full bg-gray-50 flex items-center justify-center text-lg">
                                                ${getIconForIngredient(ing.id)}
                                            </div>
                                            
                                            <span class="text-xs text-center font-medium text-gray-600 leading-tight">${ing.nombre}</span>
                                        </div>
                                    </label>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
                
                <!-- Bot√≥n Flotante Generar -->
                <div class="fixed bottom-24 right-4 left-4 z-40">
                    <button onclick="generarRecetas()" class="w-full bg-gray-900 text-white py-4 rounded-2xl shadow-xl font-bold text-lg flex items-center justify-center gap-2 transform active:scale-95 transition-all">
                        <i class="fas fa-magic text-orange-400"></i>
                        Generar Recetas (${totalItems})
                    </button>
                </div>
            `;
        }

        // 3. RECIPES VIEW (Resultados)
        function renderRecipes(container, filtradas = null) {
            let listaRecetas = filtradas || recetasMexicanas;
            
            // Si es resultado de generaci√≥n, mostrar header especial
            const esGenerado = filtradas !== null;
            
            let html = '';
            
            if (esGenerado) {
                html += `
                    <div class="mb-6">
                        <button onclick="router('inventory')" class="text-sm text-gray-500 mb-2 flex items-center gap-1">
                            <i class="fas fa-arrow-left"></i> Volver al inventario
                        </button>
                        <h2 class="text-2xl font-bold text-gray-900">¬°Puedes cocinar esto!</h2>
                        <p class="text-sm text-gray-500">Basado en tus ${miInventario.size} ingredientes</p>
                    </div>
                `;
            } else {
                html += `
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">Todas las Recetas</h2>
                        <div class="flex gap-2 mt-4 overflow-x-auto hide-scrollbar">
                            <button class="px-4 py-2 bg-orange-600 text-white rounded-full text-sm font-medium whitespace-nowrap">Todas</button>
                            <button class="px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded-full text-sm font-medium whitespace-nowrap">Desayunos</button>
                            <button class="px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded-full text-sm font-medium whitespace-nowrap">Platos Fuertes</button>
                            <button class="px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded-full text-sm font-medium whitespace-nowrap">Cenas</button>
                        </div>
                    </div>
                `;
            }

            if (listaRecetas.length === 0) {
                html += `
                    <div class="text-center py-12">
                        <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-carrot text-3xl text-gray-300"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-700">Sin coincidencias</h3>
                        <p class="text-gray-500 text-sm mt-2">Intenta agregar m√°s ingredientes a tu inventario.</p>
                        <button onclick="router('inventory')" class="mt-6 px-6 py-2 bg-orange-600 text-white rounded-full text-sm font-bold">Ir al Inventario</button>
                    </div>
                `;
            } else {
                html += `<div class="space-y-4">`;
                listaRecetas.forEach(receta => {
                    // Calcular coincidencia
                    const coincidencia = calcularCoincidencia(receta);
                    const porcentaje = Math.round((coincidencia.encontrados / coincidencia.total) * 100);
                    
                    // Color de la barra de progreso
                    let progressColor = 'bg-red-500';
                    if(porcentaje > 40) progressColor = 'bg-yellow-500';
                    if(porcentaje > 75) progressColor = 'bg-green-500';

                    html += `
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex gap-4 cursor-pointer" onclick="mostrarDetalleReceta(${receta.id})">
                            <div class="w-24 h-24 rounded-xl bg-gray-100 overflow-hidden flex-shrink-0">
                                <img src="${receta.imagen}" class="w-full h-full object-cover" alt="${receta.nombre}">
                            </div>
                            <div class="flex-1 flex flex-col justify-between">
                                <div>
                                    <div class="flex justify-between items-start">
                                        <h4 class="font-bold text-gray-800 leading-tight pr-2">${receta.nombre}</h4>
                                        <i class="far fa-heart text-gray-400 hover:text-red-500 transition-colors" onclick="event.stopPropagation(); toggleFavorito(${receta.id}, this)"></i>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1 line-clamp-1">${receta.descripcion}</p>
                                </div>
                                
                                <div>
                                    ${esGenerado ? `
                                        <div class="flex items-center justify-between text-xs mb-1">
                                            <span class="font-medium ${porcentaje === 100 ? 'text-green-600' : 'text-gray-500'}">
                                                ${porcentaje === 100 ? '¬°Tienes todo!' : `Te faltan ${coincidencia.faltantes.length}`}
                                            </span>
                                            <span class="font-bold text-gray-700">${porcentaje}%</span>
                                        </div>
                                        <div class="w-full bg-gray-100 rounded-full h-1.5">
                                            <div class="${progressColor} h-1.5 rounded-full" style="width: ${porcentaje}%"></div>
                                        </div>
                                    ` : `
                                        <div class="flex items-center gap-3 text-xs text-gray-500">
                                            <span class="flex items-center gap-1"><i class="far fa-clock"></i> ${receta.tiempo} min</span>
                                            <span class="flex items-center gap-1"><i class="fas fa-signal"></i> ${receta.dificultad}</span>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }

        // 4. FAVORITES VIEW
        function renderFavorites(container) {
            const favs = recetasMexicanas.filter(r => misFavoritos.has(r.id));
            
            let html = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Mis Favoritos</h2>
                    <p class="text-sm text-gray-500">${favs.length} recetas guardadas</p>
                </div>
            `;

            if (favs.length === 0) {
                html += `
                    <div class="text-center py-12 bg-white rounded-3xl border border-dashed border-gray-200">
                        <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="far fa-heart text-2xl text-red-300"></i>
                        </div>
                        <p class="text-gray-500">A√∫n no tienes favoritos.</p>
                    </div>
                `;
            } else {
                html += `<div class="grid grid-cols-1 gap-4">`;
                favs.forEach(receta => {
                    html += `
                        <div class="relative h-48 rounded-2xl overflow-hidden shadow-md cursor-pointer group" onclick="mostrarDetalleReceta(${receta.id})">
                            <img src="${receta.imagen}" class="absolute w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="${receta.nombre}">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent p-4 flex flex-col justify-end">
                                <h3 class="text-white font-bold text-lg">${receta.nombre}</h3>
                                <div class="flex items-center gap-3 text-gray-300 text-xs mt-1">
                                    <span><i class="far fa-clock"></i> ${receta.tiempo} min</span>
                                    <span>${receta.dificultad}</span>
                                </div>
                            </div>
                            <button onclick="event.stopPropagation(); toggleFavorito(${receta.id}, null); router('favorites')" class="absolute top-3 right-3 w-8 h-8 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-red-500 transition-colors">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }

        // ================= MODAL DETALLE RECETA =================
        function mostrarDetalleReceta(id) {
            const receta = recetasMexicanas.find(r => r.id === id);
            const coincidencia = calcularCoincidencia(receta);
            const tieneTodo = coincidencia.faltantes.length === 0;

            Swal.fire({
                html: `
                    <div class="text-left -mx-5 -mt-5">
                        <div class="h-56 relative">
                            <img src="${receta.imagen}" class="w-full h-full object-cover rounded-t-lg">
                            <button onclick="Swal.close()" class="absolute top-4 left-4 w-8 h-8 bg-white/80 rounded-full flex items-center justify-center text-gray-800 shadow-lg z-10">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                        </div>
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <span class="text-xs font-bold text-orange-600 uppercase tracking-wider">${receta.categoria}</span>
                                    <h2 class="text-2xl font-bold text-gray-900 leading-tight mt-1">${receta.nombre}</h2>
                                </div>
                                <div class="bg-gray-100 px-3 py-1 rounded-lg text-sm font-bold text-gray-700 flex flex-col items-center">
                                    <i class="fas fa-clock text-orange-500 mb-1"></i>
                                    ${receta.tiempo}'
                                </div>
                            </div>
                            
                            <p class="text-gray-500 text-sm mb-6">${receta.descripcion}</p>

                            <!-- Estado de ingredientes -->
                            <div class="mb-6 p-4 rounded-xl ${tieneTodo ? 'bg-green-50 border border-green-100' : 'bg-orange-50 border border-orange-100'}">
                                <h4 class="font-bold text-sm mb-2 ${tieneTodo ? 'text-green-800' : 'text-orange-800'}">
                                    ${tieneTodo ? '<i class="fas fa-check-circle mr-1"></i> ¬°Tienes todo listo!' : `<i class="fas fa-shopping-basket mr-1"></i> Te faltan ${coincidencia.faltantes.length} ingredientes`}
                                </h4>
                                ${!tieneTodo ? `
                                    <div class="flex flex-wrap gap-2">
                                        ${coincidencia.faltantes.map(i => `<span class="px-2 py-1 bg-white rounded text-xs font-medium text-gray-600 border border-gray-200">${obtenerNombreIngrediente(i)}</span>`).join('')}
                                    </div>
                                ` : ''}
                            </div>

                            <h3 class="font-bold text-lg mb-3">Ingredientes</h3>
                            <ul class="space-y-2 mb-6">
                                ${receta.ingredientesBase.map(ing => {
                                    const tengo = miInventario.has(ing);
                                    return `
                                    <li class="flex items-center justify-between text-sm pb-2 border-b border-gray-50 last:border-0">
                                        <span class="flex items-center gap-2 ${tengo ? 'text-gray-800' : 'text-gray-400'}">
                                            <i class="fas fa-circle text-[6px] ${tengo ? 'text-green-500' : 'text-gray-300'}"></i>
                                            ${obtenerNombreIngrediente(ing)}
                                        </span>
                                        ${tengo ? '<i class="fas fa-check text-green-500 text-xs"></i>' : '<span class="text-[10px] text-red-400 font-medium">Falta</span>'}
                                    </li>`;
                                }).join('')}
                            </ul>

                            <h3 class="font-bold text-lg mb-3">Preparaci√≥n</h3>
                            <div class="space-y-4">
                                ${receta.instrucciones.map((paso, index) => `
                                    <div class="flex gap-3">
                                        <div class="flex-shrink-0 w-6 h-6 rounded-full bg-orange-100 text-orange-600 font-bold text-xs flex items-center justify-center mt-0.5">
                                            ${index + 1}
                                        </div>
                                        <p class="text-sm text-gray-600 leading-relaxed">${paso}</p>
                                    </div>
                                `).join('')}
                            </div>

                            <button class="w-full mt-8 bg-gray-900 text-white font-bold py-3 rounded-xl shadow-lg" onclick="Swal.close()">
                                Cerrar Receta
                            </button>
                        </div>
                    </div>
                `,
                showConfirmButton: false,
                customClass: {
                    popup: 'rounded-2xl overflow-hidden p-0',
                    container: 'p-0'
                },
                width: '100%',
                padding: 0,
                background: '#fff'
            });
        }

        // ================= FUNCIONES L√ìGICAS =================
        
        function toggleInventario(ingId) {
            if(miInventario.has(ingId)) {
                miInventario.delete(ingId);
            } else {
                miInventario.add(ingId);
            }
            // Animaci√≥n visual peque√±a
            if(window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(50); // Feedback h√°ptico m√≥vil
            }
        }

        function generarRecetas() {
            if (miInventario.size === 0) {
                Swal.fire({
                    icon: 'info',
                    title: 'Despensa Vac√≠a',
                    text: 'Agrega algunos ingredientes en la secci√≥n de Inventario primero.',
                    confirmButtonColor: '#EA580C',
                    confirmButtonText: 'Ir al Inventario'
                }).then((result) => {
                    if (result.isConfirmed) router('inventory');
                });
                return;
            }

            // Animaci√≥n de carga simulada
            const appContent = document.getElementById('app-content');
            appContent.innerHTML = `
                <div class="flex flex-col items-center justify-center h-[60vh] text-center">
                    <div class="w-20 h-20 border-4 border-orange-200 border-t-orange-600 rounded-full animate-spin mb-4"></div>
                    <h3 class="text-xl font-bold text-gray-800">El Chef est√° pensando...</h3>
                    <p class="text-gray-500">Buscando las mejores combinaciones</p>
                </div>
            `;

            // L√≥gica de filtrado
            const resultados = recetasMexicanas.map(receta => {
                const coincidencia = calcularCoincidencia(receta);
                return { ...receta, coincidencia };
            })
            .filter(r => r.coincidencia.encontrados > 0) // Solo mostrar si tengo ALGO
            .sort((a, b) => b.coincidencia.porcentaje - a.coincidencia.porcentaje); // Ordenar por mejor match

            setTimeout(() => {
                renderRecipes(appContent, resultados);
                
                // Actualizar nav
                document.querySelectorAll('.bottom-nav-item').forEach(el => el.classList.remove('active', 'text-orange-600'));
                document.getElementById('nav-recipes').classList.add('active', 'text-orange-600');
            }, 800);
        }

        function calcularCoincidencia(receta) {
            const total = receta.ingredientesBase.length;
            let encontrados = 0;
            let faltantes = [];

            receta.ingredientesBase.forEach(ing => {
                if(miInventario.has(ing)) {
                    encontrados++;
                } else {
                    faltantes.push(ing);
                }
            });

            return {
                total,
                encontrados,
                faltantes,
                porcentaje: (encontrados / total) * 100
            };
        }

        function toggleFavorito(id, btnElement) {
            if(misFavoritos.has(id)) {
                misFavoritos.delete(id);
                if(btnElement) {
                    btnElement.classList.remove('fas', 'text-red-500');
                    btnElement.classList.add('far');
                }
            } else {
                misFavoritos.add(id);
                if(btnElement) {
                    btnElement.classList.remove('far');
                    btnElement.classList.add('fas', 'text-red-500');
                }
                
                // Toast notification
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 1500,
                    timerProgressBar: true
                });
                Toast.fire({
                    icon: 'success',
                    title: 'A√±adido a favoritos'
                });
            }
        }

        // Helpers
        function getIconForIngredient(id) {
            const map = {
                'pollo': 'üçó', 'res': 'ü•©', 'cerdo': 'üçñ', 'huevo': 'ü•ö',
                'tomate': 'üçÖ', 'cebolla': 'üßÖ', 'ajo': 'üßÑ', 'chile': 'üå∂Ô∏è',
                'cilantro': 'üåø', 'aguacate': 'ü•ë', 'limon': 'üçã',
                'tortillas': 'ü´ì', 'frijoles': 'ü´ò', 'arroz': 'üçö',
                'queso': 'üßÄ', 'crema': 'ü•õ'
            };
            return map[id] || 'ü•ò';
        }

        function obtenerNombreIngrediente(id) {
            const ing = ingredientesComunesDB.find(i => i.id === id);
            return ing ? ing.nombre : id;
        }

        // ================= INIT =================
        document.addEventListener('DOMContentLoaded', () => {
            router('home');
            
            // Pre-llenar inventario con algo para demo
            miInventario.add('tortillas');
            miInventario.add('queso');
            miInventario.add('tomate');
        });

    </script>
</body>
</html>
